# 实现路线图

> **版本**: 2.0.0
> **状态**: Draft
> **最后更新**: 2024-12-17

---

## 1. 概述

本文档定义 AgentX Agentic RAG 系统的实现路线图，包括开发阶段、里程碑和详细任务分解。

> **注意**: 本文档已更新以反映实际技术选型（Hono/SQLite）和当前进度。

### 相关文档

| 文档 | 描述 |
|------|------|
| [项目初始化](./PROJECT-SETUP.md) | 项目结构和初始化 |
| [开发环境配置](./DEV-ENVIRONMENT.md) | 开发环境设置 |
| [Agentic 架构](./AGENTIC-ARCHITECTURE.md) | 多角色架构设计 |
| [SPEC-001 系统概述](../SPEC-001-SYSTEM-OVERVIEW.md) | 系统愿景和范围 |

---

## 2. 开发阶段概览

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           AgentX Agentic RAG 开发路线图                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Phase 0        Phase 1        Phase 2        Phase 3        Phase 4       │
│  ─────────      ─────────      ─────────      ─────────      ─────────     │
│  项目初始化     核心后端        文档处理        对话系统        角色记忆       │
│                                                                             │
│  Week 1         Week 2-3       Week 4-5       Week 6-7       Week 8-9      │
│                                                                             │
│  ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐      │
│  │ 项目架子 │   │ 助手CRUD │   │ 文档上传 │   │ 对话管理 │   │ 角色系统 │      │
│  │ 基础设施 │   │ 用户认证 │   │ 文本提取 │   │ RAG检索  │   │ 记忆系统 │      │
│  │ 开发环境 │   │ 基础API  │   │ 向量化   │   │ 流式响应 │   │ 学习机制 │      │
│  └─────────┘   └─────────┘   └─────────┘   └─────────┘   └─────────┘      │
│       │             │             │             │             │            │
│       ▼             ▼             ▼             ▼             ▼            │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        Phase 5: 前端开发 (Week 10-12)                │   │
│  │  助手管理UI │ 文档管理UI │ 对话界面 │ 设置页面 │ 整体优化              │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                      │                                      │
│                                      ▼                                      │
│                            ┌─────────────────┐                              │
│                            │  MVP 发布 🚀    │                              │
│                            │   Week 13       │                              │
│                            └─────────────────┘                              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. Phase 0: 项目初始化（Week 1）✅ 已完成

### 3.1 目标

建立项目基础架构，配置开发环境，确保团队可以开始开发。

### 3.2 任务清单

| 任务 | 优先级 | 预估时间 | 状态 |
|------|--------|----------|------|
| 创建 Monorepo 结构 | P0 | 2h | ✅ |
| 配置 pnpm workspace | P0 | 1h | ✅ |
| 初始化后端项目（Hono） | P0 | 2h | ✅ |
| 初始化前端项目（React + Vite） | P0 | 2h | ✅ |
| 配置 TypeScript | P0 | 1h | ✅ |
| 配置 ESLint + Prettier | P1 | 1h | ✅ |
| 配置 Docker Compose（Qdrant） | P0 | 2h | ✅ |
| 配置 SQLite 数据库 | P0 | 2h | ✅ |
| 创建数据库 Schema | P0 | 4h | ✅ |
| 编写 README | P1 | 1h | ✅ |

### 3.3 交付物

- [x] 可运行的项目骨架
- [x] Docker 环境（Qdrant）
- [x] SQLite 数据库初始 Schema
- [x] 开发文档

### 3.4 验收标准

- [x] `pnpm install` 成功
- [x] `pnpm dev` 可启动前后端
- [x] `pnpm test` 可运行测试
- [x] Qdrant Docker 服务正常启动
- [x] SQLite 数据库自动初始化

---

## 4. Phase 1: 核心后端（Week 2-3）✅ 已完成

### 4.1 目标

实现助手管理的完整 CRUD 功能和简化认证系统。

### 4.2 任务清单

#### Week 2: 基础架构

| 任务 | 优先级 | 预估时间 | 状态 |
|------|--------|----------|------|
| 实现 Hono 服务器框架 | P0 | 4h | ✅ |
| 实现请求验证中间件（Zod） | P0 | 2h | ✅ |
| 实现错误处理中间件 | P0 | 2h | ✅ |
| 实现日志系统（Pino） | P0 | 2h | ✅ |
| 实现健康检查端点 | P0 | 1h | ✅ |
| 实现 SQLite 数据访问层 | P0 | 4h | ✅ |
| 实现 API Key 认证（MVP 简化） | P0 | 2h | ✅ |

#### Week 3: 助手管理

| 任务 | 优先级 | 预估时间 | 状态 |
|------|--------|----------|------|
| 实现创建助手 API | P0 | 4h | ✅ |
| 实现查询助手列表 API | P0 | 3h | ✅ |
| 实现查询助手详情 API | P0 | 2h | ✅ |
| 实现更新助手 API | P0 | 3h | ✅ |
| 实现删除助手 API | P0 | 3h | ✅ |
| 实现助手设置管理 | P1 | 4h | ✅ |
| 编写单元测试 | P0 | 8h | ✅ |
| 编写集成测试 | P1 | 4h | ✅ |

### 4.3 交付物

- [x] API Key 认证（MVP 简化）
- [x] 助手 CRUD API
- [x] 单元测试和集成测试

### 4.4 验收标准

参考 Feature 文件：
- [002-create-assistant.feature](../features/assistant/002-create-assistant.feature)
- [002-query-assistant.feature](../features/assistant/002-query-assistant.feature)
- [002-update-assistant.feature](../features/assistant/002-update-assistant.feature)
- [002-delete-assistant.feature](../features/assistant/002-delete-assistant.feature)

---

## 5. Phase 2: 文档处理（Week 4-5）

### 5.1 目标

实现文档上传、解析、向量化的完整流水线。

### 5.2 任务清单

#### Week 4: 文档上传和解析

| 任务 | 优先级 | 预估时间 | 依赖 |
|------|--------|----------|------|
| 实现文件上传端点 | P0 | 4h | Phase 1 |
| 实现文件类型验证 | P0 | 2h | 文件上传 |
| 实现文件大小验证 | P0 | 1h | 文件上传 |
| 实现 PDF 文本提取 | P0 | 4h | 文件上传 |
| 实现 Word 文本提取 | P0 | 4h | 文件上传 |
| 实现 TXT/MD 文本提取 | P0 | 2h | 文件上传 |
| 实现 Excel 文本提取 | P1 | 4h | 文件上传 |
| 实现文本清理 | P0 | 3h | 文本提取 |
| 实现异步任务队列 | P0 | 4h | - |
| 实现处理状态更新 | P0 | 3h | 任务队列 |

#### Week 5: 向量化和索引

| 任务 | 优先级 | 预估时间 | 依赖 |
|------|--------|----------|------|
| 实现语义分块 | P0 | 6h | 文本清理 |
| 实现 OpenAI Embeddings 集成 | P0 | 4h | 分块 |
| 实现 Qdrant 客户端 | P0 | 4h | - |
| 实现向量存储 | P0 | 4h | Qdrant + Embeddings |
| 实现文档列表查询 | P0 | 3h | 向量存储 |
| 实现文档删除（含向量清理） | P0 | 4h | 向量存储 |
| 实现处理失败重试 | P1 | 3h | 任务队列 |
| 编写单元测试 | P0 | 6h | 所有功能 |
| 编写集成测试 | P1 | 4h | 单元测试 |

### 5.3 交付物

- [ ] 文档上传 API
- [ ] 文档处理流水线
- [ ] 向量存储和索引
- [ ] 文档管理 API
- [ ] 处理状态实时更新

### 5.4 验收标准

参考 Feature 文件：
- [003-upload-document.feature](../features/document/003-upload-document.feature)
- [003-process-document.feature](../features/document/003-process-document.feature)
- [003-manage-documents.feature](../features/document/003-manage-documents.feature)

---

## 6. Phase 3: 对话系统（Week 6-7）

### 6.1 目标

实现智能对话系统，包括 RAG 检索和流式响应。

### 6.2 任务清单

#### Week 6: 对话管理和 RAG

| 任务 | 优先级 | 预估时间 | 依赖 |
|------|--------|----------|------|
| 实现创建对话 API | P0 | 3h | Phase 2 |
| 实现对话列表查询 | P0 | 2h | 创建对话 |
| 实现对话详情查询 | P0 | 2h | 创建对话 |
| 实现删除对话 | P0 | 2h | 创建对话 |
| 实现向量相似度搜索 | P0 | 6h | Qdrant |
| 实现 RAG 检索逻辑 | P0 | 6h | 向量搜索 |
| 实现上下文构建 | P0 | 4h | RAG |
| 实现来源引用提取 | P0 | 4h | RAG |

#### Week 7: 流式响应和 LLM 集成

| 任务 | 优先级 | 预估时间 | 依赖 |
|------|--------|----------|------|
| 实现 Claude API 集成 | P0 | 4h | - |
| 实现提示词模板 | P0 | 4h | Claude |
| 实现流式响应（SSE） | P0 | 6h | Claude |
| 实现消息存储 | P0 | 3h | 流式响应 |
| 实现对话标题自动生成 | P1 | 3h | 消息存储 |
| 实现生成中断 | P1 | 4h | 流式响应 |
| 实现多轮对话上下文 | P0 | 4h | 消息存储 |
| 编写单元测试 | P0 | 6h | 所有功能 |
| 编写集成测试 | P1 | 4h | 单元测试 |

### 6.3 交付物

- [ ] 对话管理 API
- [ ] RAG 检索系统
- [ ] 流式响应（SSE）
- [ ] 来源引用标注
- [ ] 多轮对话支持

### 6.4 验收标准

参考 Feature 文件：
- [004-create-conversation.feature](../features/conversation/004-create-conversation.feature)
- [004-send-message.feature](../features/conversation/004-send-message.feature)
- [004-stream-response.feature](../features/conversation/004-stream-response.feature)

---

## 7. Phase 4: PromptX 集成（Week 8-9）

### 7.1 目标

集成 PromptX MCP，实现角色激活和记忆功能。

> **重要说明**：角色和记忆功能由 PromptX 提供，本项目只需要调用 MCP 接口，不需要自己实现。

### 7.2 任务清单

#### Week 8: PromptX MCP 集成

| 任务 | 优先级 | 预估时间 | 依赖 |
|------|--------|----------|------|
| 配置 MCP 客户端 | P0 | 4h | Phase 3 |
| 实现助手角色激活（promptx_action） | P0 | 4h | MCP 客户端 |
| 实现子代理角色激活 | P0 | 4h | 助手角色 |
| 实现角色切换流程 | P0 | 4h | 子代理角色 |
| 在对话流程中集成角色激活 | P0 | 6h | 角色切换 |

#### Week 9: 记忆集成

| 任务 | 优先级 | 预估时间 | 依赖 |
|------|--------|----------|------|
| 实现记忆保存（promptx_remember） | P0 | 4h | PromptX |
| 实现记忆检索（promptx_recall） | P0 | 4h | 记忆保存 |
| 实现 DMN 模式记忆检索 | P1 | 3h | 记忆检索 |
| 在对话流程中集成记忆 | P0 | 6h | 记忆检索 |
| 编写集成测试 | P1 | 4h | 所有功能 |

### 7.3 交付物

- [ ] PromptX MCP 客户端配置
- [ ] 角色激活流程（助手 + 子代理）
- [ ] 记忆保存和检索集成
- [ ] 对话流程中的角色和记忆使用

### 7.4 验收标准

参考 Feature 文件：
- [005-role-management.feature](../features/role-memory/005-role-management.feature)
- [005-role-switching.feature](../features/role-memory/005-role-switching.feature)
- [005-memory-management.feature](../features/role-memory/005-memory-management.feature)
- [005-learning.feature](../features/role-memory/005-learning.feature)

---

## 8. Phase 5: 前端开发（Week 10-12）

### 8.1 目标

实现完整的 Web 用户界面。

### 8.2 任务清单

#### Week 10: 基础架构和助手管理

| 任务 | 优先级 | 预估时间 | 依赖 |
|------|--------|----------|------|
| 配置 React Router | P0 | 2h | Phase 0 |
| 配置 TanStack Query | P0 | 2h | Router |
| 配置 Zustand | P0 | 2h | Query |
| 实现布局组件 | P0 | 4h | 配置完成 |
| 实现导航组件 | P0 | 3h | 布局 |
| 实现登录页面 | P0 | 4h | 布局 |
| 实现注册页面 | P0 | 3h | 登录 |
| 实现助手列表页面 | P0 | 6h | 认证 |
| 实现创建助手对话框 | P0 | 4h | 助手列表 |
| 实现助手详情页面 | P0 | 6h | 助手列表 |
| 实现助手设置页面 | P1 | 4h | 助手详情 |

#### Week 11: 文档管理和对话界面

| 任务 | 优先级 | 预估时间 | 依赖 |
|------|--------|----------|------|
| 实现文档上传组件 | P0 | 6h | 助手详情 |
| 实现文档列表组件 | P0 | 4h | 文档上传 |
| 实现处理进度显示 | P0 | 4h | 文档列表 |
| 实现文档删除确认 | P0 | 2h | 文档列表 |
| 实现对话列表侧边栏 | P0 | 4h | 助手详情 |
| 实现对话界面 | P0 | 8h | 对话列表 |
| 实现消息输入框 | P0 | 4h | 对话界面 |
| 实现流式消息显示 | P0 | 6h | 对话界面 |
| 实现来源引用展示 | P0 | 4h | 流式消息 |

#### Week 12: 优化和完善

| 任务 | 优先级 | 预估时间 | 依赖 |
|------|--------|----------|------|
| 实现响应式设计 | P0 | 6h | 所有页面 |
| 实现加载状态 | P0 | 4h | 所有页面 |
| 实现错误处理 | P0 | 4h | 所有页面 |
| 实现空状态 | P1 | 3h | 所有页面 |
| 实现 Toast 通知 | P0 | 3h | - |
| 实现暗色模式 | P2 | 4h | - |
| 性能优化 | P1 | 6h | 所有功能 |
| 可访问性优化 | P1 | 4h | 所有功能 |
| E2E 测试 | P1 | 8h | 所有功能 |

### 8.3 交付物

- [ ] 完整的 Web 用户界面
- [ ] 响应式设计
- [ ] 流式对话体验
- [ ] E2E 测试覆盖

### 8.4 验收标准

- 所有 SPEC 中定义的用户故事可完成
- 页面加载时间 < 2s
- 移动端可用
- 无明显 UI 缺陷

---

## 9. MVP 发布（Week 13）

### 9.1 发布清单

| 任务 | 负责人 | 状态 |
|------|--------|------|
| 代码审查 | - | [ ] |
| 安全审计 | - | [ ] |
| 性能测试 | - | [ ] |
| 文档完善 | - | [ ] |
| 部署脚本 | - | [ ] |
| 监控配置 | - | [ ] |
| 备份策略 | - | [ ] |
| 发布公告 | - | [ ] |

### 9.2 MVP 功能范围

| 功能 | 状态 |
|------|------|
| API Key 认证（MVP 简化） | [x] |
| 助手 CRUD | [x] |
| 文档上传和处理 | [ ] |
| 智能对话（RAG） | [ ] |
| 流式响应 | [ ] |
| 来源引用 | [ ] |
| PromptX 角色集成 | [ ] |
| PromptX 记忆集成 | [ ] |
| Web 界面 | [ ] |

---

## 10. 后续规划（v2.0）

### 10.1 计划功能

| 功能 | 优先级 | 预估周期 |
|------|--------|----------|
| 多租户权限 | P0 | 2 周 |
| 文档版本控制 | P1 | 1 周 |
| 高级分析报告 | P1 | 2 周 |
| 批量文档处理 | P1 | 1 周 |
| 自定义提示词 | P1 | 1 周 |
| API 访问控制 | P0 | 1 周 |
| 使用量统计 | P1 | 1 周 |

### 10.2 技术债务

| 项目 | 优先级 |
|------|--------|
| 测试覆盖率提升到 90% | P1 |
| 性能优化（缓存策略） | P1 |
| 日志和监控完善 | P0 |
| 文档自动化生成 | P2 |

---

## 11. 风险管理

### 11.1 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| Claude API 限流 | 高 | 中 | 实现请求队列和重试 |
| Qdrant 性能瓶颈 | 中 | 低 | 预留扩展方案 |
| 文档解析失败 | 中 | 中 | 多种解析器备选 |
| 流式响应不稳定 | 高 | 低 | 实现断线重连 |

### 11.2 进度风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| 需求变更 | 高 | 中 | 严格变更控制 |
| 技术难点 | 中 | 中 | 预留缓冲时间 |
| 依赖延迟 | 中 | 低 | 并行开发 |

---

## 修订历史

| 版本 | 日期 | 变更说明 |
|------|------|----------|
| 1.0.0 | 2024-12-16 | 初始版本 |
| 2.0.0 | 2024-12-17 | 更新技术栈（Hono/SQLite），更新进度，简化角色/记忆为 PromptX 集成 |
