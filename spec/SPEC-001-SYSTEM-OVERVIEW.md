# SPEC-001: 系统概述

> **版本**: 2.0.0
> **状态**: Draft
> **作者**: AI Coder
> **创建日期**: 2024-12-16
> **最后更新**: 2024-12-17

---

## 1. 概述

### 1.1 目的

本文档定义 AgentX Agentic RAG 系统的整体愿景、核心理念和用户故事，为后续详细设计提供指导方向。

### 1.2 范围

- 项目愿景和目标
- 核心技术栈（AgentX + PromptX）
- 工作区架构
- 用户故事和使用场景
- 系统边界和约束
- MVP 功能范围

### 1.3 相关文档

| 文档 | 描述 |
|------|------|
| [SPEC-000-INDEX](./SPEC-000-INDEX.md) | 文档索引 |
| [技术架构设计](./design/TECHNICAL-ARCHITECTURE.md) | 技术架构详细设计 |
| [AgentX 框架](../Agent/README.md) | AgentX 框架文档 |

---

## 2. 项目愿景

### 2.1 产品定位

AgentX Agentic RAG 是一个**智能助手平台**，让用户能够：
- 创建专业领域的 AI 助手（如法律助手、财务助手、技术助手）
- 通过上传文档让助手学习专业知识
- 与助手进行智能对话，获得专业、有依据的回答
- 助手会持续学习用户偏好，提供个性化服务

### 2.2 核心价值主张

```
┌─────────────────────────────────────────────────────────────┐
│                    用户价值金字塔                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                    ┌─────────────┐                          │
│                    │  个性化服务  │  ← 持续学习用户偏好      │
│                  ┌─┴─────────────┴─┐                        │
│                  │   专业有依据    │  ← 基于文档的回答       │
│                ┌─┴─────────────────┴─┐                      │
│                │     简单易用        │  ← 无需技术背景       │
│              ┌─┴─────────────────────┴─┐                    │
│              │       即时可用          │  ← 上传即学习       │
│              └─────────────────────────┘                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 目标用户

| 用户类型 | 使用场景 | 核心需求 |
|----------|----------|----------|
| 专业人士 | 法律、财务、医疗等领域 | 快速查询专业知识，获得有依据的回答 |
| 企业用户 | 内部知识库、客服系统 | 统一知识管理，提高服务效率 |
| 研究人员 | 文献分析、资料整理 | 快速理解大量文档，提取关键信息 |
| 个人用户 | 学习助手、笔记整理 | 个性化学习，知识积累 |

---

## 3. 核心技术栈

### 3.1 技术架构概览

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           完整技术栈                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      本项目（Agentic RAG）                           │   │
│  │                                                                       │   │
│  │  • 业务数据管理（SQLite）：助手/文档/对话元数据                        │   │
│  │  • Web 界面（React）                                                  │   │
│  │  • 工作流编排：定义 Agent，配置工作区                                 │   │
│  │                                                                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│                                    │ 调用                                   │
│                                    ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                          AgentX                                      │   │
│  │                                                                       │   │
│  │  • LLM 调用（Claude API）                                            │   │
│  │  • WebSocket 通信                                                    │   │
│  │  • 事件驱动架构                                                      │   │
│  │  • MCP 服务器集成 ──────────────────────────────────────────┐        │   │
│  │  • 工作区管理                                                │        │   │
│  │                                                              │        │   │
│  └──────────────────────────────────────────────────────────────┼────────┘   │
│                                                                 │            │
│                                                                 │ MCP 调用   │
│                                                                 ▼            │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                          PromptX                                     │   │
│  │                                                                       │   │
│  │  • 角色系统（action/女娲创建角色）                                    │   │
│  │  • 记忆系统（remember/recall）                                        │   │
│  │  • 工具系统（toolx）                                                  │   │
│  │    - 系统工具：pdf-reader, word-tool, excel-tool                     │   │
│  │    - 自定义工具：向量化、检索等（可扩展）                             │   │
│  │                                                                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 职责分工

| 层级 | 职责 | 技术 |
|------|------|------|
| **本项目** | 业务数据、Web 界面、工作流编排 | Hono + React + SQLite |
| **AgentX** | LLM 调用、WebSocket、MCP 集成、工作区 | AgentX 框架 |
| **PromptX** | 角色、记忆、工具 | PromptX MCP 服务器 |

### 3.3 工作区（Workspace）概念

**核心概念**：一个助手 = 一个工作区

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           工作区架构                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  用户创建"法律助手"                                                          │
│         │                                                                   │
│         ▼                                                                   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    工作区 (Workspace)                                │   │
│  │                                                                       │   │
│  │  ┌─────────────────────────────────────────────────────────────┐    │   │
│  │  │  PromptX 资源                                                │    │   │
│  │  │  • 助手角色（legal-assistant）                               │    │   │
│  │  │  • 子代理角色（contract-law, labor-law 等）                  │    │   │
│  │  │  • 记忆数据（该助手的记忆）                                  │    │   │
│  │  │  • 自定义工具                                                │    │   │
│  │  └─────────────────────────────────────────────────────────────┘    │   │
│  │                                                                       │   │
│  │  ┌─────────────────────────────────────────────────────────────┐    │   │
│  │  │  MCP 配置                                                    │    │   │
│  │  │  • PromptX MCP 服务器                                        │    │   │
│  │  │  • 其他 MCP 服务器（如需要）                                 │    │   │
│  │  └─────────────────────────────────────────────────────────────┘    │   │
│  │                                                                       │   │
│  │  ┌─────────────────────────────────────────────────────────────┐    │   │
│  │  │  业务数据                                                    │    │   │
│  │  │  • 文档元数据                                                │    │   │
│  │  │  • 对话历史                                                  │    │   │
│  │  │  • 向量索引（Qdrant collection）                             │    │   │
│  │  └─────────────────────────────────────────────────────────────┘    │   │
│  │                                                                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**工作区包含**：
- PromptX 资源（角色、记忆、工具）
- MCP 配置
- 业务数据（文档、对话、向量）

---

## 4. 核心设计理念

### 4.1 简单易用

**原则**：用户只需要理解"助手"这一个概念，不需要了解底层技术。

```
用户视角                          技术实现
─────────                        ─────────

  助手        ═══════════════>    工作区 + PromptX 角色
    │                               │
    │                          ┌────┴────┐
    │                          │         │
  文档        ═══════════════>  向量库   PromptX 工具
    │                               │
    │                               │
  对话        ═══════════════>    AgentX + PromptX 记忆
```

**设计决策**：
- 隐藏"角色"、"向量"、"嵌入"等技术概念
- 用"助手学习文档"替代"文档向量化"
- 用"助手记住偏好"替代"PromptX 记忆系统"

### 4.2 专业智能

**原则**：回答必须基于上传的文档，有据可查。

**实现方式**：
1. **RAG 检索增强**：每次回答前检索相关文档
2. **引用标注**：回答中标注信息来源
3. **置信度提示**：当信息不足时明确告知用户

### 4.3 持续学习

**原则**：助手会越用越懂用户。

**学习内容**：
| 学习类型 | 示例 | 存储方式 |
|----------|------|----------|
| 偏好 | 用户喜欢详细的回答 | PromptX Memory |
| 习惯 | 用户常问合同风险问题 | PromptX Memory |
| 洞察 | 用户关注的重点领域 | PromptX Memory |

---

## 5. 用户故事

### 5.1 US-001: 创建助手

```gherkin
Feature: 创建助手
  As a 用户
  I want 创建一个专业领域的 AI 助手
  So that 我可以获得该领域的专业服务

  Scenario: 成功创建助手
    Given 我已登录系统
    When 我填写助手名称为 "法律助手"
    And 我填写助手描述为 "专业的法律文档分析助手"
    And 我选择领域为 "法律"
    And 我点击创建按钮
    Then 系统应该创建一个新的助手
    And 我应该看到助手创建成功的提示
    And 我应该被导航到助手详情页面
```

**详细特性文件**: [features/assistant/002-create-assistant.feature](./features/assistant/002-create-assistant.feature)

### 5.2 US-002: 上传文档

```gherkin
Feature: 上传文档
  As a 用户
  I want 上传专业文档给助手学习
  So that 助手能够基于这些文档提供专业回答

  Scenario: 成功上传 PDF 文档
    Given 我已创建一个助手
    And 我在助手的文档管理页面
    When 我选择一个 PDF 文件 "合同模板.pdf"
    And 文件大小不超过 10MB
    And 我点击上传按钮
    Then 系统应该开始处理文档
    And 我应该看到处理进度
    And 处理完成后文档状态应该变为 "已完成"
```

**详细特性文件**: [features/document/003-upload-document.feature](./features/document/003-upload-document.feature)

### 5.3 US-003: 智能问答

```gherkin
Feature: 智能问答
  As a 用户
  I want 向助手提问并获得专业回答
  So that 我可以快速获取所需信息

  Scenario: 基于文档的问答
    Given 我的助手已学习了相关文档
    And 我在对话界面
    When 我输入问题 "这份合同的主要风险点是什么？"
    And 我发送消息
    Then 助手应该检索相关文档内容
    And 助手应该生成专业回答
    And 回答应该包含文档引用
    And 回答应该以流式方式显示
```

**详细特性文件**:
- [创建对话](./features/conversation/004-create-conversation.feature)
- [发送消息](./features/conversation/004-send-message.feature)
- [流式响应](./features/conversation/004-stream-response.feature)

### 5.4 US-004: 持续学习

```gherkin
Feature: 持续学习
  As a 用户
  I want 助手记住我的偏好
  So that 下次能获得更个性化的服务

  Scenario: 学习用户偏好
    Given 我与助手进行了多轮对话
    And 我多次要求详细的分析报告
    When 我下次提问时
    Then 助手应该自动提供更详细的回答
    And 回答风格应该符合我的偏好
```

**详细特性文件**: [features/role-memory/005-learning.feature](./features/role-memory/005-learning.feature)

### 5.5 US-005: 文档管理

```gherkin
Feature: 文档管理
  As a 用户
  I want 管理助手已学习的文档
  So that 我可以更新或删除过时的知识

  Scenario: 查看文档列表
    Given 我的助手已学习了多个文档
    When 我进入文档管理页面
    Then 我应该看到所有文档的列表
    And 每个文档应该显示名称、类型、状态、上传时间

  Scenario: 删除文档
    Given 我在文档管理页面
    When 我选择删除一个文档
    And 我确认删除操作
    Then 文档应该从列表中移除
    And 相关的向量数据应该被清理
```

**详细特性文件**: [features/document/003-manage-documents.feature](./features/document/003-manage-documents.feature)

---

## 6. 系统边界

### 6.1 系统上下文图

```
                    ┌─────────────────────────────────────────┐
                    │                                         │
    ┌───────┐       │      Agentic RAG System                │
    │       │       │                                         │
    │ 用户  │◄─────►│  ┌─────────┐    ┌─────────┐            │
    │       │       │  │ Web UI  │◄──►│ Backend │            │
    └───────┘       │  │ (React) │    │ (Hono)  │            │
                    │  └─────────┘    └────┬────┘            │
                    │                      │                  │
                    │              ┌───────┴───────┐          │
                    │              │               │          │
                    │         ┌────┴────┐    ┌────┴────┐     │
                    │         │ AgentX  │    │ SQLite  │     │
                    │         │         │    │         │     │
                    │         └────┬────┘    └─────────┘     │
                    │              │                          │
                    │              │ MCP                      │
                    │              ▼                          │
                    │         ┌─────────┐    ┌─────────┐     │
                    │         │PromptX  │    │ Qdrant  │     │
                    │         │  MCP    │    │ Vector  │     │
                    │         └─────────┘    └─────────┘     │
                    │                                         │
                    └─────────────────────────────────────────┘
                                    │
                                    │
                                    ▼
                            ┌───────────────┐
                            │  Claude API   │
                            │  (LLM 服务)   │
                            └───────────────┘
```

### 6.2 系统边界定义

**系统内部**（本项目实现）：
- Web 用户界面（React）
- 后端 API 服务（Hono）
- 工作区管理
- 业务数据管理（SQLite）

**框架层**（AgentX 提供）：
- LLM 调用（Claude API）
- WebSocket 通信
- MCP 服务器集成
- 工作区运行时

**能力层**（PromptX 提供）：
- 角色系统（创建、激活）
- 记忆系统（保存、检索）
- 工具系统（文档读取、自定义工具）

**存储层**：
- SQLite（业务数据）
- Qdrant（向量数据）

### 6.3 约束条件

| 约束类型 | 描述 |
|----------|------|
| 技术约束 | 必须基于 AgentX 框架和 PromptX 集成 |
| 性能约束 | API 响应时间 < 2s，对话响应 < 5s |
| 安全约束 | 工作区数据隔离，用户数据隔离 |
| 规模约束 | MVP 阶段支持单用户，后续扩展多租户 |

---

## 7. MVP 功能范围

### 7.1 包含功能（In Scope）

| 功能模块 | 功能点 | 优先级 |
|----------|--------|--------|
| 助手管理 | 创建、查看、编辑、删除助手 | P0 |
| 文档处理 | 上传 PDF/Word/TXT，自动处理和向量化 | P0 |
| 智能对话 | 基于文档的问答，流式响应 | P0 |
| 角色调度 | 简单的角色选择和切换 | P1 |
| 记忆学习 | 基础的偏好记忆 | P1 |
| Web 界面 | 助手管理、文档管理、对话界面 | P0 |

### 7.2 不包含功能（Out of Scope）

| 功能 | 原因 | 计划版本 |
|------|------|----------|
| 多租户权限 | MVP 阶段简化 | v2.0 |
| 文档版本控制 | 非核心功能 | v2.0 |
| 复杂多角色协作 | 技术复杂度高 | v2.0 |
| 角色自动生成 | 需要更多训练数据 | v3.0 |
| 高级分析报告 | 非核心功能 | v2.0 |
| 移动端应用 | 资源限制 | v3.0 |

### 7.3 功能优先级矩阵

```
                    重要性
                    高 │
                       │  ┌─────────────┐  ┌─────────────┐
                       │  │ P0: 核心    │  │ P1: 重要    │
                       │  │ - 助手管理  │  │ - 角色调度  │
                       │  │ - 文档处理  │  │ - 记忆学习  │
                       │  │ - 智能对话  │  │             │
                       │  │ - Web界面   │  │             │
                       │  └─────────────┘  └─────────────┘
                       │
                       │  ┌─────────────┐  ┌─────────────┐
                       │  │ P2: 一般    │  │ P3: 低      │
                    低 │  │ - 对话历史  │  │ - 数据导出  │
                       │  │ - 文档搜索  │  │ - 主题定制  │
                       │  └─────────────┘  └─────────────┘
                       └──────────────────────────────────►
                         低                            高
                                    紧急性
```

---

## 8. 成功标准

### 8.1 功能验收标准

| 标准 | 描述 | 验证方式 |
|------|------|----------|
| 助手创建 | 用户可以成功创建助手 | Gherkin 场景测试 |
| 文档学习 | 文档上传后可被检索 | 集成测试 |
| 智能问答 | 回答基于文档内容 | 人工验证 + 自动测试 |
| 流式响应 | 对话实时显示 | 性能测试 |
| 记忆学习 | 偏好被正确记录 | 功能测试 |

### 8.2 性能指标

| 指标 | 目标值 | 测量方式 |
|------|--------|----------|
| API 响应时间 | < 2s (P95) | APM 监控 |
| 对话首字节时间 | < 3s | 前端埋点 |
| 文档处理速度 | < 30s/MB | 后台任务监控 |
| 系统可用性 | > 99% | 健康检查 |

### 8.3 用户体验指标

| 指标 | 目标 | 测量方式 |
|------|------|----------|
| 任务完成率 | > 90% | 用户行为分析 |
| 错误率 | < 5% | 错误日志统计 |
| 用户满意度 | > 4/5 | 用户反馈 |

---

## 9. 术语表

| 术语 | 定义 |
|------|------|
| 助手 (Assistant) | 用户创建的 AI 助手实体，对应一个工作区 |
| 工作区 (Workspace) | AgentX 中的隔离环境，包含 PromptX 资源和业务数据 |
| 文档 (Document) | 用户上传的知识文件，如 PDF、Word 等 |
| 角色 (Role) | PromptX 中的角色资源，定义 AI 的行为和能力 |
| 子代理 (SubAgent) | 领域细分的专业角色，也是 PromptX 角色 |
| 记忆 (Memory/Engrams) | PromptX 的记忆系统，保存用户偏好和交互模式 |
| 向量 (Vector) | 文档内容的数学表示，用于相似度检索 |
| RAG | Retrieval-Augmented Generation，检索增强生成 |
| MCP | Model Context Protocol，模型上下文协议 |
| AgentX | AI Agent 开发框架和运行时平台 |
| PromptX | 提供角色、记忆、工具的 MCP 服务器 |

---

## 10. 附录

### 10.1 参考资料

- [AgentX Framework 文档](../Agent/README.md)
- [PromptX 集成指南](../promptx-agenticRag/doc/技术架构/PromptX集成总结.md)

### 10.2 修订历史

| 版本 | 日期 | 作者 | 变更说明 |
|------|------|------|----------|
| 1.0.0 | 2024-12-16 | AI Coder | 初始版本 |
| 2.0.0 | 2024-12-17 | AI Coder | 添加 AgentX/PromptX/工作区概念，更新技术栈 |
